# VS Code在AI方面的可扩展性
本文提供了Visual Studio Code AI的扩展选择概览，帮助您的扩展选择正确的趋势。

VS Code包含可增强编程体验的强大AI功能：
- **代码补全**：在输入时提供行间代码建议
- **代理模式**：使用特殊工具使AI能够自主规划执行开发任务
- **聊天**：让开发者使用自然语言在聊天界面中，询问有关代码库问题或者对代码库作出编辑
- **智能操作**：处理常见开发任务时使用融合在整个编辑器的AI增强操作

你可以扩展和自定义这些内建功能来创建贴合您的用户特殊需求的定制AI体验。

## 为什么在VS Code里扩展AI

在您的扩展中添加AI功能为您的用户带来一些好处：
- **代理模式下特定领域的知识**：让代理模式访问您公司的数据源和服务
- **增强用户体验**：在您的扩展中提供定制的智能辅助
- **领域专业化**：创建应用于特定编程语言、框架或者领域的AI
- **扩展聊天功能**：在聊天界面中添加特殊工具或者助手带来更强大的互动
- **改良开发者生产力**：使用AI功能推动常规开发者的任务，如调试、代码检查或者测试

## 扩展聊天体验
### 语言模型工具
语言模型工具允许您在VS Code中扩展特定领域能力的代理模式。在代理模式，这些工具基于用户聊天提示词自动调用，并执行特定任务或者从数据源和服务中检索信息。用户也可以明确地在他们的聊天提示词中使用#提及工具引用这些工具。

要实现一个语言模型工具，在您的VS Code扩展中使用[语言模型工具API](/4.%20扩展指南/2.%20AI.md#工具)。语言模型工具可以访问所有的VS Code扩展API，并进一步融入编辑器。

**重要优势**：
- 作为自动编程工作流一部分的专业领域能力
- 您的工具实现可以使用VS Code API，因为它运行在扩展宿主进程
- 在Visual Studio市场中轻易地分发部署

**注意事项**：
- 远程部署需要扩展实现客户端-服务端交流
- 不同工具间的重复利用需要模块化设计和实现

### MCP工具

模型上下文协议（MCP）工具通过使用标准化协议，提供了将外部服务和语言模型的方式。在代理模式，这些工具基于用户聊天提示词自动调用，来处理专业化的任务或者在外部数据源中检索信息。

MCP工具在VS Code外部运行，要么在用户的机器本地运行，或者作为一项远程服务。用户可以通过JSON配置MCP工具，或者让VS Code扩展编程配置他们。你可以通过各种语言SDK和部署选择实现MCP工具。

因为MCP工具在VS Code外部运行，他们无法访问VS Code扩展API。

**重要优势**：
- 作为自动编程工作流一部分的专业领域能力
- 本地远程部署选择
- 在其他MCP客户端重复利用MCP服务端

**注意事项**：
- 无法访问VS Code扩展API
- 分发部署需要用户设置MCP服务器
### 聊天参与者
聊天参与者是允许用户扩展咨询特定领域专家的方式的专业助手。在聊天中，用户可以通过用@提及它唤起聊天参与者，并传递关于特定主题或者领域的自然语言提示词。聊天参与者将负责处理整个聊天互动。

为了实现聊天参与者，在您的VS Code扩展中使用[聊天API](#聊天)。聊天参与者可以访问所有VS Code扩展API，并更加深入融入编辑器。

**重要优势**
- 控制端对端互动流
- 运行在扩展宿主进程中，可以访问VS Code扩展API
- 在Visual Studio市场中轻易分发部署

**注意事项**：
- 远程部署需要扩展实现客户端-服务端交流
- 在不同工具间重复利用需要模块化设计和实现

## 构建您自己的AI赋能特性
为了创建您扩展中自定义的AI赋能特性，VS Code允许您通过编程访问AI模型。这个方法让您能够构建针对编辑器互动的AI能力，而不依赖于聊天界面。

为了直接使用语言模型，在您的VS Code扩展中使用[语言API](#语言模型)。您可以在任何扩展特性中包含这些AI能力，比如代码操作，悬停提供者，自定义视图和其他。

**关键特性**：
- 整合AI能力到已有的扩展特性或构建一个新的。
- 在扩展宿主进程中允许访问VS Code扩展API。
- 通过Visual Studio市场简单的分发和部署

**特别注意：**
- 跨部分的重复利用需要模块化设计和实现

## 作出决定

当在您的VS Code扩展中选择扩展AI的正确方式时，考虑以下指导：
1. 在下面情况选择语言模型工具：
    - 您应该在VS Code中扩展具有特定功能的聊天
    - 您应该在代理模式下基于用户专注的自动化调用
    - 您应该在VS Code中为了深度融合允许访问API
    - 您应该通过VS Code市场分发您的工具
2. 在下面情况选择MCP工具：
    - 您应该在VS Code中扩展具有特定功能的聊天
    - 您应该在代理模式下基于用户专注的自动化调用
    - 您不需要整合VS Code API
    - 您的工具需要在不同环境下工作（不仅仅是VS Code）
    - 您的工具需要远程或本地运行
3. 在下面情况选择聊天参与者：
    - 您应该同通过定制具有该领域专业能力的助手扩展询问模式
    - 您应该自定义整个互动流和反应行为
    - 您应该为了深度融合访问VS Code API
    - 您应该通过VS Code市场分发
4. 在下面情况选择语言模型API
    - 您想要在现有的扩展特性中整合AI能力
    - 您想要在聊天界面之外构建UI体验
    - 您想要直接编程控制AI模型请求

## 下一步
选择最适合您扩展目标的方法：

- [实现语言模型工具]
- [在您的VS Code扩展中注册MCP工具]
- [在语言模型API中整合AI]
- [实现聊天参与者]
- [在行间补全API中扩展AI补全]

## 示例项目 
- [聊天示例](https://github.com/microsoft/vscode-extension-samples/tree/main/chat-sample)：具有代理模式工具和聊天参与者的扩展
- [代码教练聊天参与者教程]：构建定制化聊天助手
- [AI赋能代码注解教程]：手把手教你使用语言模型API
- [MCP扩展示例](https://github.com/microsoft/vscode-extension-samples/tree/main/mcp-extension-sample)：注册MCP工具的扩展
# 语言模型工具API
语言模型工具允许您扩展聊天中大语言模型（LLM）的大部分功能。VSCode中的[代理](https://code.visualstudio.com/docs/copilot/chat/copilot-chat)可以自动调用这些工具，处置聊天当中的特殊任务来用户的聊天提示词。

通过在VS Code扩展中贡献语言模型工具，您可以在扩展代理编程工作流的同时，提供更深层次与编辑器的融合。扩展工具与[内建工具和MCP工具](https://code.visualstudio.com/docs/copilot/chat/chat-tools#_types-of-tools)是三种可用工具类型。

在这篇扩展指南，您可以学习如何通过是使用语言模型工具API创建语言模型工具，和如何实现在聊天扩展中调用的工具。

您也可以通过贡献[MCP服务端](#MCP开发者指南)使用特殊工具扩展聊天体验。关于不同选择和如何确定方法的详情参见[API扩展概述](#vs-code在ai方面的可扩展性)。

> 提示
> 作为终端用户获取更多使用工具的信息，参见[在聊天中使用工具](https://code.visualstudio.com/docs/copilot/chat/chat-tools)

## 什么工具叫做LLM
语言模型工具是可以作为语言模型请求一部分调用的函数。例如，您可能有一个函数，它在数据库中检索信息，处理计算或者调用在线API。当你在VS Code扩展中贡献工具时，代理模式可以在那时基于聊天上下文调用工具。

LLM从不实际执行工具自身，而是生成用于调用工具的参数。清楚描述工具的目的、功能和输入参数是重要的，这样才能让工具可以在正确的上下文被调用。

下面的图示展示了代理模式下的工具调用流。关于涉及的具体步骤详情参见[工具调用流程](#语言模型工具api)。

![](https://code.visualstudio.com/assets/api/extension-guides/ai/tools/copilot-tool-calling-flow.png)

在OpenAI文档中阅读更多有关[函数调用](https://platform.openai.com/docs/guides/function-calling)

## 为什么在扩展里实现一个语言模型工具

在实现语言模型工具有几个优势：

- 使用特殊、专业的工具，自动作为用户提示词的回复部分调用，**扩展代理模式**。例如，允许搭建、查询数据库来动态提供LLM相关上下文。

- 使用广泛的扩展API**与VS Code深度融合**。例如，使用[调试API](/4.%20扩展指南/16.%20调试器扩展.md)得到当前的调试上下文并作为工具功能一部分使用。

- 通过Visual Studio市场**分发部署**，提供可依赖和无缝的用户体验。用户不需要单独安装更新工具的过程。

您可能在下面的情景中考虑使用[MCP服务端](#mcp开发者指南)实现语言模型工具：
- 您已经实现了MCP服务端，也想要在VS Code中使用它。
- 您想要在不同的开发环境和平台复用同样的工具。
- 您的工具远程作为宿主服务。
- 您不需要访问VS Code API

在[工具类型的不同](https://code.visualstudio.com/docs/copilot/chat/chat-tools#_types-of-tools)了解更多

## 创建语言模型工具

实现语言模型工具包括两个主要部分：

1. 在扩展的`package.json`文件定义工具配置。
2. 使用[语言模型API引用](/9.%20参考/1.%20VS%20Code%20API.md)在扩展代码中实现工具

您可以使用[基本示例项目](https://github.com/microsoft/vscode-extension-samples/tree/main/chat-sample)开始

### 1. 在package.json中静态配置

定义扩展的语言模型工具的第一步，是在`package.json`文件中定义它。这个配置包括工具名称、简介、输入框架和其他元数据：

1. 在扩展`package.json`文件的`contributes.languageModelTools`字段中为您的工具添加一个项。

2. 给工具一个独特的名称

| 属性 | 简介 |
| - | - |
| `name` | 工具的独特名称，在扩展实现代码中引用。采用`{动词}_{名词}`格式命名。参见[命名指南](#指南与惯例)。 |
| `displayName` | 工具的用户友好名称，在UI中展示 |

3. 如果工具可以使用[代理](#聊天概览)或在聊天提示词中用`#`引用，加入下面属性：

用户可以在聊天视图中启用或禁用工具，类似[模型上下文协议(MCP)工具](https://code.visualstudio.com/docs/copilot/customization/mcp-servers)中所做。

| 属性 | 简介 | 
| - | - |
| `canBeReferencedInPrompt` | 设置为`true`如果工具可以和`代理`一起使用，或可在聊天中引用。 |
| `toolReferenceName` | 用户在聊天上下文中使用`#`引用的名称。 |
| `icon` | 工具在UI中展示的图标。 |
| `userDescription` | 工具的用户友好介绍，在UI中展示。 |

4. 在`modelDescription`中添加详细的介绍。这个信息被LLM用来决定你的工具应该使用哪个上下文。

- 工具实际上做什么
- 它应该返回何种信息
- 何时应当或不应当它被使用
- 介绍工具重要的限制或约束

5. 如果工具需要输入参数，添加`inputSchema`属性介绍工具的输入参数。

这个JSON框架介绍了工具作为输入的属性对象，和它是否应该需要。文件路径应为绝对路径。

介绍各个参数的作用和它与工具功能的关联。

6. 添加`时句`控制工具是否可用

使用`时句`，`languageModelTools`贡献点允许你限制代理模式下提示词中工具可用或可被引用的时间。例如，获取调试调用栈信息的工具，只应在用户调试时可用。

```json
"contributes":{
    "languageModelTools": [
        {
            "name": "chat-tools-sample_tabCount",
            ...
            "when":"debugState == 'running'"
        }
    ]
}
```

<details>
<summary>
<b>
示例工具定义
</b>
</summary>
下面的示例展示了如何定义计数活动组中活动栏数量的工具

```json
{
    "contributes": {
        "languageModelTools": [
            {
                "name": "chat-tools-sample_tabCount",
                "tags": [
                    "editors",
                    "chat-tools-sample"
                ],
                "toolsReferenceName": "tabCount",
                "displayName": "Tab Count",
                "modelDescription": "The number of active tabs in a tab group in VS Code.",
                "userDescription": "Count the number of active tabs in a tab group.",
                "canBeReferencedInPrompt": true,
                "icon": "$(files)",
                "inputSchema": {
                    "type": "object",
                    "properties": {
                        "tabGroup": {
                            "type": "number",
                            "description": "The index of the tab group to check. This is optional- if not specified, the active tab group will be checked.",
                            "default": 0
                        }
                    }
                }
            }
        ]
    }
}
```
</details>

### 2. 工具实现
使用[语言模型API](/9.%20参考/1.%20VS%20Code%20API.md)实现语言模型工具。这包括下面步骤

1. 在扩展启用时，使用`vscode.lm.registerTool`注册工具。

如您在`package.json`的`name`属性中指定的那样，提供工具的名称。

如果您想要工具在扩展中私有，跳过工具注册步骤。

```typescript
export function registerChatTools(context: vscode.ExtensionContext) {
    context.subscriptions.push(
        vscode.lm.registerTool('chat-tools-sample_tabCount', new TabCountTool())
    );
}
```

2. 创建实现[`vscode.LanguageModelTool<>`](/9.%20参考/1.%20VS%20Code%20API.md)接口的类

3. 在`prepareInvocation`方法中添加工具确认信息

一个普通的确认对话框会一直在扩展中展示，但工具可以自定义确认信息。给用户足够的上下文理解工具在做什么。这个信息可以是包含代码块的`MarkdownString`。

下面步骤展示了如何为栏数工具提供确认信息。

```typescript
async prepareInvocation(
    options: vscode.LanguageModelToolInvocationPrepareOptions<ITabCountParameters>,
    _token: vscode.CancellationToken
) {
    const confirmationMessages = {
        title: 'Count the number of open tabs',
        message: new vscode.MarkdownString(
            `Count the number of open tabs?` +
            (options.input.tabGroup !== undefined
                ? ` in tab group ${options.input.tabGroup}`
                : '')
        ),
    };
    return {
        invocationMessage: 'Counting the number of tabs',
        confirmationMessages,
    };
}
```

如果`prepareInvocation`返回`undefined`，将展示普通确认信息。注意用户同样可以选择“一直允许”某个工具。

4. 定义描述用户输入参数的接口。

此接口用于`vscode.LanguageModelTool`类的`invoke`方法。输入参数会与您在`package.json`的`inputSchema`定义的JSON框架校对。

下面的粒子展示了栏数工具的接口。

```typescript
export interface ITabCountParameters {
    tabGroup?: number;
}
```

5. 实现`invoke`方法。这个方法在处理聊天提示词调用语言模型工具时被调用。

`invoke`方法接受`options`参数中的工具输入参数。参数会与`package.json`的`inputSchema`定义的JSON框架校对。

当错误发生时，会抛出LLM能理解的错误。您可以选择提供给LLM接下来做什么的说明，比如使用不同参数重试或使用不同的操作。

下面的例子展示了栏数工具的实现。工具的结果是`vscode.LanguageModelToolResult`类型的实例。

```typescript
async invoke(
    options: vscode.LanguageModelToolInvocationOptions<ITabCountParameters>,
    _token: vscode.CancellationToken
) {
    const params = options.input;
    if(typeof params.tabGroup === 'number') {
        const group = vscode.window.tabGroups.all[Math.max(params.tabGroup - 1, 0)];
        const nth = params.tabGroup === 1
            ? '1st'
            : params.tabGroup === 2
                ? '2nd'
                : parmas.tabGroup === 3
                    ? '3rd'
                    : `${params.tabGroup}th`;
        return new vscode.LanguageModelToolResult([new vscode.LanguageModelTextPart(`There are ${group.tabs.length} tabs open in the ${nth} tab group.`)]);

    } else {
        const group = vscode.window.tabGroups.activeTabGroup;
        return new vscode.LanguageModelToolResult([new vscode.LanguageModelTextPart(`There are ${group.tabs.length} tabs open.`)]);
    }
}
```

在VS Code扩展实例仓库中查看完整实现[语言模型工具](https://github.com/microsoft/vscode-extension-samples/blob/main/chat-sample/src/tools.ts)的源代码。

## 工具调用流程

当用户发送聊天提示词，会发生下面的步骤：

1. Copilot基于用户的配置决定可用的工具列表。

工具列表包括内建工具，扩展注册工具和来自[MCP服务端](https://code.visualstudio.com/docs/copilot/customization/mcp-servers)的工具。您通过扩展或者MCP服务端（图示中用绿色展示）贡献代理模式。

2. Copilot给LLM发送请求，提供提示词、聊天上下文和工具定义列表来思考。

LLM生成回复，可能包括一个或多个请求调用工具。

3. 如果需要，Copilot的LLM提供参数值推荐的工具。

工具回复可能导致多个工具调取请求。

4. 如果有错误或接下来的工具请求，Copilot遍历工具调用流直到所有工具请求解决。

5. Copilot返回最终回复给用户，可能包括不同工具的请求。

### 指南和惯例

- **命名**：为工具和参数写明清晰、简要的名称。
    - **工具名称**：需要独特清晰介绍它的意图。使用`{动词}_{名词}`格式结构为工具命名。例如，`get_weather`，`get_azure_deployment`或`get_terminal_output`。
    - **参数名称**：需要介绍参数的目的。使用`{名词}`格式结构为参数命名。例如：`destination_location`，`ticker`或`file_name`。

- **介绍**：为工具和参数写详细的介绍。
    - 介绍工具做什么和它什么时候应该或不应该使用。例如，“这个工具为给定的位置检索天气”。
    - 介绍每个参数的用法和它与工具功能的关联。例如，“`destination_location`参数指定检索天气的位置。它应该是个合法的位置名称或坐标。”
    - 介绍工具重要的限制或约束。例如，“这个工具仅能为合众国的信息检索天气数据。在其他区域可能无法使用。”

- **用户确认**：提供工具调取的确认信息。虽然普通的确认对话框会在扩展工具中一直展示，但工具可以自定义确认消息。给用户充足的上下文来明白工具在做什么。

- **错误处理**：当错误发生，使用LLM能理解的消息抛出错误。您可以给LLM说明下一步应该做什么，比如使用不同的参数重试或使用不同的操作.

在[OpenAI文档](https://platform.openai.com/docs/guides/function-calling?api-mode=chat#best-practices-for-defining-functions)和[Anthropic文档](https://docs.anthropic.com/en/docs/build-with-claude/tool-use/overview)中获取更多创建工具的优秀实践。

## 相关内容
- [语言模型API参考](/9.%20参考/1.%20VS%20Code%20API.md)
- [在VS Code扩展中注册MCP服务器](#MCP开发者指南)
- [在代理模式下使用MCP工具](https://code.visualstudio.com/docs/copilot/customization/mcp-servers)

# MCP开发者指南


模型上下文协议（MCP）是让AI模型能通过统一接口与外部工具和服务互动的开放标准。Visual Studio Code实现完全的MCP规范，允许您创建MCP服务端提供工具、提示词和资源扩展VS Code AI代理的能力。

MCP服务端和内建工具、扩展贡献工具同样提供VS Code可用的三种工具类型之一。在[工具类型](https://code.visualstudio.com/docs/copilot/agents/agent-tools#_types-of-tools)了解更多。

本指南涵盖您构建MCP服务端所需要的一切，让您与VS Code和其他MCP客户端紧密协作

> 提示
> 有关作为终端用户使用MCP的信息，参见[在VS Code使用MCP服务端](https://code.visualstudio.com/docs/copilot/customization/mcp-servers)

## 为什么使用MCP服务端

在VS Code中实现MCP服务端扩展语言模型工具聊天有如下优势：

- 使用特殊、专业的工具，自动作为用户提示词的回复部分调用，**扩展代理模式**。例如，允许搭建、查询数据库来动态提供LLM相关上下文。
- 为本地或远程情景提供**灵活部署选择**
- 在不同工具和平台**复用**您的MCP服务端。

您可能会在下列情景考虑用[语言模型API]实现语言模型工具：

- 您想要使用扩展API与VS Code深度融合。
- 您想要通过Visual Studio市场分发工具与更新。

## VS Code支持的MCP特性

VS Code支持下面MCP能力：

- [传输](https://modelcontextprotocol.io/specification/2025-06-18/basic/transports)：
    - 本地标准输入/输出(stdio)
    - 流HTTP(http)
    - 服务端发送事件(sse) - 旧版支持
- [特性](https://modelcontextprotocol.io/specification/2025-06-18#features)：
    - 工具：使用额外工具扩展[代理模式](https://code.visualstudio.com/docs/copilot/chat/copilot-chat#_builtin-chat-modes)
    - 提示词：在聊天使用斜杠命令用复用提示词
    - 资源：提供数据和内容，用户可以添加作为聊天上下文或直接在VS Code中互动。
    - 获取：向用户请求输入
    - 采样：使语言模型请求使用用户配置模型和订阅
    - 验证：使用OAuth验证对MCP服务端的访问
    - 服务端说明
    - 根：提供用户工作空间根目录的信息
    - [MCP应用程序](https://modelcontextprotocol.github.io/ext-apps/api/)：返回工具互动性UI组件
### 工具
#### 工具定义
VS Code支持代理模式下的MCP工具。在此模式下，MCP工具可以基于任务需要调用。用户可以使用工具选择器启用或配置它们。工具简介在工具选择器以及在运行工具前的确认窗口和工具名称一同展示。

![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/mcp-tools-picker.png)

用户可以编辑在工具确认对话框中的模型生成的输入参数。确认对话框会为所有没有被标记为`readOnlyHint`注解的工具展示。

![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/mcp-tool-input-parameters.png)

#### 动态工具搜索
VS Code也支持[动态工具搜索](https://modelcontextprotocol.io/specification/2025-06-18/server/tools#tool-discovery-and-updates)，允许服务端在运行时注册工具。例如，服务端可以基于检测到工作空间或用户聊天提示词的语言或框架提供不同的工具。

#### 工具注解
为了提供额外关于工具行为元数据，您可以使用[工具注解](https://modelcontextprotocol.io/docs/concepts/tools#tool-annotations)
- `title`：人类可阅读的工具标题，当工具被调用时在聊天视图展示。
- `readOnlyHint`：表明工具只读的可选提示。VS Code不会在运行只读工具前征求同意。

### 资源
资源允许您用结构化的方式提供数据和内容给用户。用户可以直接在VS Code中访问资源，或者在聊天提示词中用作上下文。例如，MCP服务端可以生成截图，使它们作为资源，或提供对实时更新的日志文件的访问。

当您定义MCP资源时，资源名称在MCP资源快速选取中展示。资源可以通过**MCP：浏览资源**命令或在聊天请求中找到**添加上下文**，然后选择**MCP资源**。资源可以包括文本或二进制内容。

![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/mcp-resources-picker.png)

VS Code支持资源更新，允许用户在编辑器中实时查看资源内容更新。

#### 资源模板

VS Code同样支持[资源模板](https://modelcontextprotocol.io/specification/2025-06-18/server/resources#resource-templates)，允许用户在引用资源时提供输入参数。例如，数据库查询工具可能要求数据表名称。

当访问模板资源时，有哦那个在快速选单中提供需要的参数。您可以提供参数建议值的补全。

### 提示词
在用户可以通过斜杠命令(`mcp.servername.promptname`)调用聊天提示词模板的聊天中，提示词是可以复用的。提示词在引导用户使用您的服务端是非常有用的，它可以强调不同的工具或提供内建复杂工作流以适应用户本地上下文和服务。

如果您定义了提示词输入参数建议值的[补全](https://modelcontextprotocol.io/specification/2025-06-18/server/utilities/completion)，VS Code会显示对话框自用户收集输入。

```typescript
server.prompt(
    'teamGreeting',
    'Generate a greeting for team members',
    {
        name: completable(z.string(), value => {
            return ['Alice', 'Bob', 'Charlie'].filter(n => n.startsWith(value));
        })
    },
    async ({ name } => ({
        messages: [
            {
                role: 'assistant',
                content: { type: 'text', text: `Hello ${name}, welcome to the team!` }
            }
        ]
    }))
);
```
![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/mcp-prompt-argument.png)

> 注意
> 用户可以在提示词对话框输入控制台命令并使用命令输出作为提示词的输入。

当您的提示词响应包含资源类型时，VS Code将资源作为上下文提供给聊天提示词。

### 验证
VS Code提供的MCP服务端需要验证，允许用户与一个代表它们服务账户的MCP服务端互动。

[验证规范](https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization)清晰地将MCP服务端分割为资源服务端和验证服务端，允许开发者将验证委托给已有的身份认证提供者（IdP）而非从零构建自己的OAuth实现。

VS Code有来自GitHub和Microsoft Entra的内建验证支持。如果您的MCP服务端实现最新的规范并且使用GitHub或Microsoft Entra作为验证服务端，用户可以通过**账户菜单** > **管理信任的MCP服务端**操作管理哪些MCP服务端可以访问账户。

![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/manage-trusted-mcp.png)

VS Code支持使用GitHub和Microsoft Entra之外的其他OAuth 2.1标准和2.0标准验证。VS Code会启动[动态客户端注册（DCR）](https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization#dynamic-client-registration)握手，如果IdP不支持DCR，随后回到客户端证书工作流。这为每个MCP服务端不同的IdP或特殊客户端ID秘密对有根据地提供了更多灵活性。

用户随后可以通过**账户菜单**查看验证状态。如果要移除动态客户端注册，用户可以在命令面板使用**验证：移除动态验证提供者**命令。

在下面是确保MCP服务端和VS Code OAuth工作流正常工作的检查列表：

1. MCP服务端定义了[MCP验证规范](https://modelcontextprotocol.io/specification/2025-06-18/basic/authorization)
2. IdP必须支持DCR或客户端证书中的一种。

3. URL重定向列表必须包含这些URL：`http://127.0.0.1:33418`和`https://vscode.dev/redirect`

当DCR不被MCP服务端支持时，用户会回到客户端证书流程：
![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/mcp-auth-dynamic-client-required.png)
![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/mcp-auth-client-id.png)
![](https://code.visualstudio.com/assets/api/extension-guides/ai/mcp/mcp-auth-client-secret.png)
> 注意
> VS Code仍然支持作为验证服务端的MCP服务端，但推荐为最新服务端使用最新规范。

### 采样

VS Code为MCP服务端提供了[采样](https://modelcontextprotocol.io/specification/2025-06-18/client/sampling)权限。这允许您的MCP服务端使用用户配置模型和订阅发出语言模型请求