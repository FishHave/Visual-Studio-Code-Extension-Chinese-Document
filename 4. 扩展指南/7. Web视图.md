# Webè§†å›¾

Webè§†å›¾APIå…è®¸æ‰©å±•åœ¨Visual Studio Codeä¸­åˆ›å»ºå®Œå…¨è‡ªå®šä¹‰çš„è§†å›¾ã€‚ä¾‹å¦‚ï¼Œå†…å»ºMarkdownæ‰©å±•ä½¿ç”¨Webè§†å›¾æ¸²æŸ“Markdowné¢„è§ˆã€‚Webè§†å›¾åŒæ ·ç”¨äºæ„å»ºè¶…å‡ºVS Code APIæ”¯æŒçš„å¤æ‚ç”¨æˆ·ç•Œé¢

æŠŠWebè§†å›¾æƒ³è±¡æˆVS Codeä¸­å—æ‚¨æ‰©å±•æ§åˆ¶çš„`iframe`ã€‚ä¸€ä¸ªWebè§†å›¾å¯ä»¥åœ¨ç”»é¢ä¸­æ¸²æŸ“å‡ ä¹ä»»ä½•HTMLå†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¿¡æ¯ä¼ é€’æ²Ÿé€šæ‰©å±•ã€‚è¿™æ ·çš„è‡ªç”±ä½¿Webè§†å›¾éå¸¸å¼ºå¤§ï¼Œå¹¶ä¸”å¼€æ‹“äº†å®Œæ•´çš„æ‰©å±•æ–°å¯èƒ½

é€šè¿‡å‡ ä¸ªVS Code APIä½¿ç”¨Webè§†å›¾ï¼š

- é€šè¿‡`createWebviewPanel`ä½¿ç”¨Webè§†å›¾é¢æ¿ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼ŒWebè§†å›¾é¢æ¿åœ¨VS Codeæ˜¾ç¤ºä¸ºä¸åŒçš„ç¼–è¾‘å™¨ã€‚è¿™ä½¿å®ƒä»¬æ›´æœ‰æ•ˆåœ°æ˜¾ç¤ºè‡ªå®šä¹‰UIå’Œè‡ªå®šä¹‰å¯è§†åŒ–
- ä½œä¸ºä¸€ä¸ª[è‡ªå®šä¹‰ç¼–è¾‘å™¨](9.%20è‡ªå®šä¹‰ç¼–è¾‘å™¨.md)çš„è§†å›¾ã€‚è‡ªå®šä¹‰ç¼–è¾‘å™¨å…è®¸æ‰©å±•æä¾›è‡ªå®šä¹‰UIä»¥åœ¨å·¥ä½œç©ºé—´ä¸­ç¼–è¾‘ä»»ä½•æ–‡ä»¶ã€‚è‡ªå®šä¹‰ç¼–è¾‘å™¨APIåŒæ ·ä½¿æ‚¨çš„æ‰©å±•è¿æ¥åˆ°å¦‚æ’¤é”€å’Œæ¢å¤çš„ç¼–è¾‘å™¨äº‹ä»¶å’Œå¦‚ä¿å­˜çš„æ–‡ä»¶äº‹ä»¶
- åœ¨æ¸²æŸ“åœ¨è¾¹æ æˆ–é¢æ¿åŒºåŸŸçš„[Webè§†å›¾è§†å›¾](/9.%20å‚è€ƒ/1.%20VS%20Code%20API.md#WebviewView)ã€‚å‚é˜…[Webè§†å›¾è§†å›¾ç¤ºä¾‹æ‰©å±•](https://github.com/microsoft/vscode-extension-samples/tree/main/webview-view-sample)

æœ¬é¡µä¸“æ³¨äºåŸºç¡€Webè§†å›¾é¢æ¿APIï¼Œå°½ç®¡å‡ ä¹è¿™é‡ŒåŒ…å«çš„æ‰€æœ‰ä¸œè¥¿éƒ½é€‚ç”¨äºè‡ªå®šä¹‰ç¼–è¾‘å™¨ä¸­å’ŒWebè§†å›¾è§†å›¾çš„Webè§†å›¾ã€‚å³ä½¿æ‚¨å¯¹é‚£äº›APIæ›´æ„Ÿå…´è¶£ï¼Œä½†æ˜¯æˆ‘ä»¬æ›´æ¨èé¦–å…ˆé€šè¯»æœ¬é¡µæ¥ç†Ÿæ‚‰Webè§†å›¾åŸºç¡€

## é“¾æ¥

- [Webè§†å›¾ç¤ºä¾‹](https://github.com/microsoft/vscode-extension-samples/blob/main/webview-sample/README.md)
- [è‡ªå®šä¹‰ç¼–è¾‘å™¨æ–‡æ¡£](9.%20è‡ªå®šä¹‰ç¼–è¾‘å™¨.md)
- [Webè§†å›¾è§†å›¾ç¤ºä¾‹](https://github.com/microsoft/vscode-extension-samples/tree/main/webview-view-sample)

### ç”¨åˆ°çš„VS Code API

- [`window.createWebviewPanel`](/9.%20å‚è€ƒ/1.%20VS%20Code%20API.md#window)
- [`window.registerWebviewPanelSerializer`](/9.%20å‚è€ƒ/1.%20VS%20Code%20API.md#window)

## æˆ‘åº”è¯¥é€‚ç”¨Webè§†å›¾å—ï¼Ÿ

Webè§†å›¾å¾ˆæ£’ï¼Œä½†å®ƒä»¬åŒæ ·åº”è¯¥ä»…å½“VS CodeåŸç”ŸAPIä¸å¤Ÿå¥½æ—¶èŠ‚çº¦ä½¿ç”¨ã€‚Webè§†å›¾æ˜¯è‡ƒè‚¿çš„èµ„æºè¿è¡Œåœ¨ä¸€ä¸ªç›¸å¯¹æ™®é€šæ‰©å±•ç‹¬ç«‹çš„ç¯å¢ƒã€‚ä¸€ä¸ªè®¾è®¡ç³Ÿç³•çš„Webæ‰©å±•å¯ä»¥è½»æ˜“åœ°ä»¤äººåœ¨VS Codeä¸­æ„Ÿåˆ°æ ¼æ ¼ä¸å…¥

åœ¨ä½¿ç”¨Webè§†å›¾ä¹‹å‰ï¼Œè¯·å¤šè™‘å¦‚ä¸‹ï¼š

- è¿™ä¸ªåŠŸèƒ½æ˜¯å¦çœŸçš„éœ€è¦åœ¨VS Codeä¸­ï¼Ÿå®ƒä¼šä¸ä¼šåœ¨ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ä¸­ä¼šæ›´å¥½ï¼Ÿ
- ä¸€ä¸ªWebè§†å›¾æ˜¯å¦æ˜¯å”¯ä¸€çš„é€”å¾„å®ç°æ‚¨çš„åŠŸèƒ½ï¼Ÿæ‚¨æ˜¯å¦å¯ä»¥ä½¿ç”¨å¸¸è§„çš„VS Code APIä»£æ›¿ï¼Ÿ
- æ‚¨çš„Webè§†å›¾æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä½¿ç”¨ä»·å€¼æŠµæ¶ˆå®ƒçš„é«˜èµ„æºæ¶ˆè€—ï¼Ÿ

è®°ä½ï¼šæ‚¨åªæ˜¯å¯ä»¥ä½¿ç”¨Webè§†å›¾åšä¸€äº›äº‹ï¼Œè€Œä¸æ„å‘³ç€æ‚¨åº”è¯¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è‡ªä¿¡åœ°è®¤ä¸ºæ‚¨éœ€è¦ä½¿ç”¨Webè§†å›¾ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡æ¡£ä¼šå¸®åŠ©æ‚¨ã€‚è®©æˆ‘ä»¬å¼€å§‹å§

## Webè§†å›¾APIåŸºç¡€

ä¸ºäº†è§£é‡ŠWebè§†å›¾APIï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå«åš**Cat Codingï¼ˆç¼–ç¨‹çš„çŒ«ï¼‰**çš„ç®€å•æ‰©å±•ã€‚è¿™ä¸ªæ‰©å±•å°†ä½¿ç”¨Webè§†å›¾æ˜¾ç¤ºä¸€ä¸ªæ­£åœ¨ç¼–å†™ä¸€äº›ä»£ç ï¼ˆå¯èƒ½ä½¿ç”¨VS Codeï¼‰çš„çŒ«çš„GIFã€‚å½“æˆ‘ä»¬è§£å†³APIåï¼Œä¼šç»§ç»­ç»™æ‰©å±•æ·»åŠ ä¸€äº›åŒ…æ‹¬ä¸€ä¸ªè¿½è¸ªæˆ‘ä»¬çš„çŒ«ç¼–å†™çš„æºä»£ç è¡Œæ•°çš„è®¡æ•°å™¨å’Œå½“çŒ«å†™å‡ºæ¼æ´æ—¶é€šçŸ¥ç”¨æˆ·çš„åŠŸèƒ½ã€‚

è¿™æ˜¯**Cat Coding**æ’ä»¶çš„ç¬¬ä¸€ç‰ˆ`package.json`ã€‚æ‚¨å¯ä»¥[åœ¨è¿™](https://github.com/microsoft/vscode-extension-samples/blob/main/webview-sample/README.md)æ‰¾åˆ°è¿™ä¸ªç¤ºä¾‹åº”ç”¨çš„å®Œæ•´ä»£ç ã€‚æˆ‘ä»¬çš„ç¬¬ä¸€ç‰ˆæ‰©å±•[è´¡çŒ®äº†ä¸€ä¸ªå‘½ä»¤](/9.%20å‚è€ƒ/2.%20è´¡çŒ®ç‚¹.md#contributes.commands)å«åš`catCoding.start`ã€‚å½“ç”¨æˆ·è°ƒç”¨è¿™æ¡å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬ä¼šå±•ç¤ºä¸€ä¸ªç®€å•çš„Webè§†å›¾ï¼Œæˆ‘ä»¬çš„çŒ«åœ¨é‡Œé¢ã€‚å¦‚æœä»–ä»¬æ„¿æ„çš„è¯ï¼Œç”¨æˆ·å¯ä»¥ä»**å‘½ä»¤é¢æ¿**è°ƒç”¨**Cat Coding: Start new cat coding session**çš„å‘½ä»¤ç”šè‡³å¯ä»¥ç»™å®ƒåˆ›å»ºä¸€ä¸ªæŒ‰é”®ç»‘å®šæ¥ä½¿ç”¨

```json
{
  "name": "cat-coding",
  "description": "Cat Coding",
  "version": "0.0.1",
  "publisher": "bierner",
  "engines": {
    "vscode": "^1.74.0"
  },
  "activationEvents": [],
  "main": "./out/src/extension",
  "contributes": {
    "commands": [
      {
        "command": "catCoding.start",
        "title": "Start new cat coding session",
        "category": "Cat Coding"
      }
    ]
  },
  "scripts": {
    "vscode:prepublish": "tsc -p ./",
    "compile": "tsc -watch -p ./",
    "postinstall": "node ./node_modules/vscode/bin/install"
  },
  "dependencies": {
    "vscode": "*"
  },
  "devDependencies": {
    "@types/node": "^9.4.6",
    "typescript": "^2.8.3"
  }
}
```

> **æ³¨ï¼š**å¦‚æœæ‚¨çš„æ‰©å±•é¢å‘ç‰ˆæœ¬ä½äº1.74çš„VS Codeï¼Œå¿…é¡»æ¸…æ¥šåœ°åœ¨`activationEvents`ä¸­åˆ—å‡º`onCommand:catCoding.start`

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å®ç°`catCoding.start`å‘½ä»¤ã€‚åœ¨æˆ‘ä»¬æ‰©å±•çš„ä¸»æ–‡ä»¶ï¼Œæˆ‘ä»¬æ³¨å†Œ`catCoding.start`å‘½ä»¤å¹¶ä¸”ä½¿ç”¨å®ƒæ˜¾ç¤ºä¸€ä¸ªåŸºç¡€Webè§†å›¾

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      // åˆ›å»ºå¹¶ä¸”æ˜¾ç¤ºä¸€ä¸ªæ–°çš„Webè§†å›¾
      const panel = vscode.window.createWebviewPanel(
        'catCoding', // è¯†åˆ«Webè§†å›¾çš„ç±»å‹ã€‚å†…éƒ¨ä½¿ç”¨
        'Cat Coding', // é¢æ¿æ˜¾ç¤ºç»™ç”¨æˆ·çš„æ ‡é¢˜
        vscode.ViewColumn.One, // æ˜¾ç¤ºæ–°Webè§†å›¾é¢æ¿çš„ç¼–è¾‘å™¨æ æ•°
        {} // Webè§†å›¾é€‰é¡¹ï¼Œå¾…ä¼šä¼šå¡«å……
      );
    })
  );
}
```

`vscode.window.createWebviewPanel`å‡½æ•°åˆ›å»ºå¹¶ä¸”åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºäº†ä¸€ä¸ªWebè§†å›¾ã€‚ä¸‹é¢æ˜¯æ‚¨å°è¯•åœ¨å½“å‰çŠ¶æ€è¿è¡Œ`catCoding.start`å‘½ä»¤çš„æ‰€è§

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-no_content.png)

æˆ‘ä»¬çš„å‘½ä»¤æ‰“å¼€äº†ä¸€ä¸ªæ–°çš„å…·æœ‰æ­£ç¡®æ ‡é¢˜çš„Webè§†å›¾é¢æ¿ï¼Œä½†æ²¡æœ‰å†…å®¹ï¼ä¸ºäº†æ·»åŠ æˆ‘ä»¬çš„çŒ«åˆ°æ–°é¢æ¿ï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦ä½¿ç”¨`webview.html`è®¾ç½®Webè§†å›¾çš„HTMLå†…å®¹

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      // åˆ›å»ºå¹¶ä¸”æ˜¾ç¤ºé¢æ¿
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      // å’Œè®¾ç½®å®ƒçš„HTMLå†…å®¹
      panel.webview.html = getWebviewContent();
    })
  );
}

function getWebviewContent() {
  return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Coding</title>
</head>
<body>
    <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" />
</body>
</html>`;
}
```

å¦‚æœæ‚¨å†æ¬¡è¿è¡Œå‘½ä»¤ï¼Œç°åœ¨çš„Webè§†å›¾é•¿è¿™æ ·ï¼š

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-html.png)

çªç ´ï¼

`webview.html`åº”è¯¥ä¸€ç›´æ˜¯ä¸€ä¸ªå®Œæ•´çš„HTMLæ–‡æ¡£ã€‚HTMLç‰‡æ®µæˆ–ç•¸å½¢çš„HTMLå¯èƒ½ä¼šé€ æˆæ— æ³•é¢„æ–™çš„è¡Œä¸º

### æ›´æ–°Webè§†å›¾å†…å®¹

`webview.html`å¯ä»¥åœ¨Webè§†å›¾åˆ›å»ºåæ›´æ–°å®ƒçš„å†…å®¹ã€‚è®©æˆ‘ä»¬ä½¿ç”¨å®ƒé€šè¿‡çŒ«çš„è½®æ›¿ä½¿**Cat Coding**ä¼šåŠ¨

```typescript
import * as vscode from 'vscode';

const cats = {
  'Coding Cat': 'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif',
  'Compiling Cat': 'https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif'
};

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      let iteration = 0;
      const updateWebview = () => {
        const cat = iteration++ % 2 ? 'Compiling Cat' : 'Coding Cat';
        panel.title = cat;
        panel.webview.html = getWebviewContent(cat);
      };

      // è®¾ç½®åˆå§‹åŒ–å†…å®¹
      updateWebview();

      // æ¯ç§’ç»™å†…å®¹æ·»åŠ è®¡åˆ’æ›´æ–°
      setInterval(updateWebview, 1000);
    })
  );
}

function getWebviewContent(cat: keyof typeof cats) {
  return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Coding</title>
</head>
<body>
    <img src="${cats[cat]}" width="300" />
</body>
</html>`;
}
```

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-update.gif)

ä¸é‡è½½å†…åµŒæ¡†æ¶ç±»ä¼¼ï¼Œè®¾ç½®`webview.html`æ›¿æ¢å…¨éƒ¨çš„å†…å®¹ã€‚é‡è¦çš„æ˜¯ç‰¢è®°ä¸€æ—¦æ‚¨åœ¨Webè§†å›¾ä¸­ä½¿ç”¨è„šæœ¬ï¼Œæ„å‘³ç€è®¾ç½®`webview.html`åŒæ ·ä¼šé‡ç½®è„šæœ¬çŠ¶æ€

ä¸Šé¢çš„ç¤ºä¾‹åŒæ ·ä½¿ç”¨`webview.title`æ¥æ›´æ”¹æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨ä¸­çš„æ–‡æ¡£çš„æ ‡é¢˜ã€‚è®¾ç½®æ ‡é¢˜ä¸ä¼šä½¿Webè§†å›¾é‡è½½

### ç”Ÿå‘½å‘¨æœŸ

åˆ›å»ºWebè§†å›¾é¢æ¿çš„æ‰©å±•æ‹¥æœ‰å®ƒä»¬ã€‚æ‰©å±•å¿…é¡»ä¸`createWebviewPanel`è¿”å›çš„Webè§†å›¾ä¿æŒè”ç³»ã€‚å¦‚æœæ‚¨çš„æ‰©å±•ä¸¢å¤±è”ç³»ï¼Œå°±ä¸å†èƒ½è·å¾—Webè§†å›¾çš„è®¿é—®æƒï¼Œå³ä½¿Webè§†å›¾èƒ½ç»§ç»­åœ¨VS Codeä¸­æ˜¾ç¤º

ä¸æ–‡æœ¬ç¼–è¾‘å™¨ç±»ä¼¼ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨ä»»ä½•æ—¶å€™å…³é—­ä¸€ä¸ªWebè§†å›¾ã€‚å½“ç”¨æˆ·è¿™ä¹ˆåšæ—¶ï¼ŒWebè§†å›¾æœ¬èº«ä¼šè¢«é”€æ¯ã€‚å°è¯•é”€æ¯ä¸€ä¸ªWebè§†å›¾ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè¿™æ„å‘³ç€ä¸Šé¢ä½¿ç”¨`setInterval`çš„ç¤ºä¾‹å…¶å®æœ‰ä¸€ä¸ªé‡è¦æ¼æ´ï¼šå¦‚æœç”¨æˆ·å…³é—­é¢æ¿ï¼Œå°†å°è¯•æ›´æ–°`panel.webview.html`çš„`setInterval`ä¼šç»§ç»­è§¦å‘ï¼Œå½“ç„¶ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚çŒ«è®¨åŒå¼‚å¸¸ã€‚è®©æˆ‘ä»¬ä¿®å¤å®ƒ

Webè§†å›¾é”€æ¯æ—¶`onDidDispose`äº‹ä»¶ä¼šè§¦å‘ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªäº‹ä»¶å–æ¶ˆè¿›ä¸€æ­¥çš„æ›´æ–°å¹¶æ¸…ç†Webè§†å›¾çš„èµ„æºï¼š

```typescript
import * as vscode from 'vscode';

const cats = {
  'Coding Cat': 'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif',
  'Compiling Cat': 'https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif'
};

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      let iteration = 0;
      const updateWebview = () => {
        const cat = iteration++ % 2 ? 'Compiling Cat' : 'Coding Cat';
        panel.title = cat;
        panel.webview.html = getWebviewContent(cat);
      };

      updateWebview();
      const interval = setInterval(updateWebview, 1000);

      panel.onDidDispose(
        () => {
          //å½“é¢æ¿å…³é—­æ—¶ï¼Œå–æ¶ˆWebè§†å›¾å†…å®¹ä»»ä½•è¿›ä¸€æ­¥çš„æ›´æ–°
          clearInterval(interval);
        },
        null,
        context.subscriptions
      );
    })
  );
}
```

æ‰©å±•å¯ä»¥åœ¨Webè§†å›¾é€šè¿‡è°ƒç”¨`dispose()`ç¼–ç¨‹å…³é—­Webè§†å›¾ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³é™åˆ¶æˆ‘ä»¬çš„çŒ«çš„å·¥ä½œæ—¥åˆ°äº”ç§’ï¼š

```typescript

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      panel.webview.html = getWebviewContent(cats['Coding Cat']);

      // 5ç§’åï¼Œç¼–ç¨‹å…³é—­Webè§†å›¾é¢æ¿
      const timeout = setTimeout(() => panel.dispose(), 5000);

      panel.onDidDispose(
        () => {
          // åœ¨äº”ç§’å‰å¤„ç†ç”¨æˆ·å…³é—­é¢æ¿
          clearTimeout(timeout);
        },
        null,
        context.subscriptions
      );
    })
  );
}

```

## å¯è§æ€§å’Œç§»åŠ¨

å½“Webè§†å›¾é¢æ¿ç§»åŠ¨åˆ°åå°æ æ—¶ï¼Œå®ƒä¼šéšè—ã€‚ç„¶è€Œå®ƒæ²¡æœ‰é”€æ¯ã€‚å½“Webé¢æ¿ç§»åŠ¨åˆ°å‰å°æ—¶ï¼ŒVS Codeä¼šè‡ªåŠ¨ä»`webview.html`æ¢å¤Webè§†å›¾çš„å†…å®¹ã€‚

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-restore.gif)

`.visible`å±æ€§å‘Šè¯‰æ‚¨å½“å‰çš„Webè§†å›¾é¢æ¿æ˜¯å¦å¯è§

æ‰©å±•å¯ä»¥é€šè¿‡è°ƒç”¨`reveal()`ç¼–ç¨‹è®©Webè§†å›¾ç§»åŠ¨åˆ°å‰å°ï¼Œè¿™ä¸ªæ–¹æ³•ä»¤ä¸€ä¸ªå¯é€‰çš„ç›®æ ‡è§†å›¾æ å±•ç¤ºå…¶ä¸­çš„é¢æ¿ã€‚æœ‰ä¸ªWebè§†å›¾é¢æ¿ä¹Ÿè®¸ä¸€æ¬¡ä»…å±•ç¤ºå•ä¸ªç¼–è¾‘å™¨æ ã€‚è°ƒç”¨`reveal()`æˆ–æ‹–æ‹½ä¸€ä¸ªWebè§†å›¾é¢æ¿åˆ°æ–°çš„ç¼–è¾‘å™¨æ ä½¿Webè§†å›¾ç§»åŠ¨åˆ°é‚£ä¸ªæ–°çš„ä¸€æ 

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-drag.gif)

è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„æ‰©å±•ï¼Œä½¿ä¹‹ä»…å…è®¸ä¸€æ¬¡å­˜åœ¨å•ä¸ªWebè§†å›¾ã€‚å¦‚æœé¢æ¿åœ¨åå°ï¼Œé‚£ä¹ˆ`catCoding.start`å‘½ä»¤å°†å¸¦å®ƒåˆ°å‰å°

```typescript
export function activate(context: vscode.ExtensionContext) {
  // è·Ÿè¸ªå½“å‰Webè§†å›¾é¢æ¿
  let currentPanel: vscode.WebviewPanel | undefined = undefined;

  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const columnToShowIn = vscode.window.activeTextEditor
        ? vscode.window.activeTextEditor.viewColumn
        : undefined;

      if (currentPanel) {
        // å¦‚æœæˆ‘ä»¬å·²ç»æ‹¥æœ‰ä¸€ä¸ªé¢æ¿ï¼Œå°†å®ƒå±•ç¤ºåˆ°ç›®æ ‡æ 
        currentPanel.reveal(columnToShowIn);
      } else {
        // å¦åˆ™ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¢æ¿
        currentPanel = vscode.window.createWebviewPanel(
          'catCoding',
          'Cat Coding',
          columnToShowIn,
          {}
        );
        currentPanel.webview.html = getWebviewContent('Coding Cat');

        // å½“å½“å‰é¢æ¿å…³é—­æ—¶é‡ç½®
        currentPanel.onDidDispose(
          () => {
            currentPanel = undefined;
          },
          null,
          context.subscriptions
        );
      }
    })
  );
}
```

è¿™æ˜¯å¯ç”¨çš„æ–°æ‰©å±•

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-single_panel.gif)

æ— è®ºä½•æ—¶ä¸€ä¸ªWebè§†å›¾çš„å¯è§æ€§æ›´æ”¹ï¼Œæˆ–è€…å½“ä¸€ä¸ªWebè§†å›¾ç§»åŠ¨åˆ°æ–°æ æ—¶ï¼Œä¼šè§¦å‘`onDidChangeViewState`äº‹ä»¶ã€‚æˆ‘ä»¬çš„æ‰©å±•å¯ä»¥ä½¿ç”¨è¿™ä¸ªäº‹ä»¶æ ¹æ®Webè§†å›¾å±•ç¤ºçš„æ æ›´æ”¹çŒ«

```typescript
const cats = {
  'Coding Cat': 'https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif',
  'Compiling Cat': 'https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif',
  'Testing Cat': 'https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif'
};

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );
      panel.webview.html = getWebviewContent('Coding Cat');

      // æ ¹æ®è§†å›¾çŠ¶æ€æ›´æ”¹æ›´æ–°å†…å®¹
      panel.onDidChangeViewState(
        e => {
          const panel = e.webviewPanel;
          switch (panel.viewColumn) {
            case vscode.ViewColumn.One:
              updateWebviewForCat(panel, 'Coding Cat');
              return;

            case vscode.ViewColumn.Two:
              updateWebviewForCat(panel, 'Compiling Cat');
              return;

            case vscode.ViewColumn.Three:
              updateWebviewForCat(panel, 'Testing Cat');
              return;
          }
        },
        null,
        context.subscriptions
      );
    })
  );
}

function updateWebviewForCat(panel: vscode.WebviewPanel, catName: keyof typeof cats) {
  panel.title = catName;
  panel.webview.html = getWebviewContent(catName);
}
```

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-ondidchangeviewstate.gif)

![](https://code.visualstudio.com/assets/api/extension-guides/webview/basics-ondidchangeviewstate.gif)

### æ£€æŸ¥ä¸è°ƒè¯•è§†å›¾

**Developer: Toggle Developer Toolsï¼ˆå¼€å‘äººå‘˜ï¼šåˆ‡æ¢å¼€å‘äººå‘˜å·¥å…·ï¼‰**å‘½ä»¤æ‰“å¼€ä¸€ä¸ªæ‚¨å¯ä»¥ç”¨äºè°ƒè¯•å’Œæ£€æŸ¥æ‚¨çš„Webè§†å›¾çš„[å¼€å‘è€…å·¥å…·](https://developer.chrome.com/docs/devtools/)è§†å›¾

![](https://code.visualstudio.com/assets/api/extension-guides/webview/developer-overview.png)

æ³¨æ„å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ä½äº1.56ç‰ˆæœ¬çš„VS Codeï¼Œæˆ–è€…æ‚¨æ­£åœ¨å°è¯•è°ƒè¯•ä¸€ä¸ªè®¾ç½®äº†`enableFindWidget`Webè§†å›¾ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨**Developer: Open Webview Developer Toolsï¼ˆå¼€å‘äººå‘˜ï¼šæ‰“å¼€Webviewå¼€å‘ï¼‰**å‘½ä»¤æ›¿ä»£ã€‚è¿™ä¸ªå‘½ä»¤ç»™æ¯ä¸ªWebè§†å›¾æ‰“å¼€ä¸€ä¸ªä¸“é—¨çš„å¼€å‘è€…å·¥å…·é¡µè€Œä¸æ˜¯ä½¿ç”¨æ‰€æœ‰Webè§†å›¾å’Œç¼–è¾‘å™¨æœ¬èº«å…±äº«çš„å¼€å‘è€…å·¥å…·é¡µ

é€šè¿‡å¼€å‘è€…å·¥å…·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä½äºå¼€å‘è€…å·¥å…·çª—å£å·¦ä¸Šè§’çš„æ£€æŸ¥å·¥å…·å¼€å§‹æ£€æŸ¥æ‚¨Webè§†å›¾çš„å†…å®¹

![](https://code.visualstudio.com/assets/api/extension-guides/webview/developer-inspect.png)

æ‚¨ä¹Ÿå¯ä»¥åœ¨å¼€å‘è€…å·¥å…·æ§åˆ¶å°æŸ¥çœ‹æ‰€æœ‰çš„Webè§†å›¾é”™è¯¯å’Œæ—¥å¿—

![](https://code.visualstudio.com/assets/api/extension-guides/webview/developer-console.png)

å¦‚æœè¦åœ¨æ‚¨çš„Webè§†å›¾ç¯å¢ƒæ±‚å€¼ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç¡®ä¿ä»å¼€å‘è€…å·¥å…·æ§åˆ¶å°é¢æ¿å·¦ä¸Šè§’ä¸‹æ‹‰èœå•é€‰æ‹©**å¯ç”¨çš„ç”»é¢**ç¯å¢ƒ

![](https://code.visualstudio.com/assets/api/extension-guides/webview/developer-active-frame.png)

**å¯ç”¨çš„ç”»é¢**ç¯å¢ƒæ˜¯Webè§†å›¾è„šæœ¬æœ¬èº«æ‰§è¡Œçš„åœ°æ–¹

å¦å¤–ï¼Œ**Developer: Reload Webviewï¼ˆå¼€å‘äººå‘˜ï¼šé‡æ–°åŠ è½½Webè§†å›¾ï¼‰**å‘½ä»¤é‡æ–°åŠ è½½æ‰€æœ‰å¯ç”¨çš„Webè§†å›¾ã€‚å¦‚æœæ‚¨éœ€è¦é‡ç½®Webä¸€ä¸ªè§†å›¾çŠ¶æ€æˆ–è€…å¦‚æœä¸€äº›ç£ç›˜ä¸Šçš„Webè§†å›¾å†…å®¹å·²ç»æ”¹å˜è¿‡å¹¶ä¸”æ‚¨æƒ³è¦åŠ è½½æ–°å†…å®¹ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„

## åŠ è½½æœ¬åœ°å†…å®¹

å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒWebè§†å›¾è¿è¡Œåœ¨ä¸€ä¸ªä¸å¯ç›´æ¥è®¿é—®æœ¬åœ°èµ„æºçš„ç‹¬ç«‹çš„ç¯å¢ƒã€‚è¿™æ„å‘³ç€ä¸ºäº†ä»æ‚¨çš„æ‰©å±•ä¸­åŠ è½½å›¾åƒã€æ ·å¼è¡¨å’Œå…¶ä»–èµ„æºæˆ–ä»ç”¨æˆ·å½“å‰çš„å·¥ä½œç©ºé—´åŠ è½½ä»»ä½•å†…å®¹ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨`Webview.asWebviewUri`å‡½æ•°å°†æœ¬åœ°çš„`file:`URIè½¬æ¢æˆä¸€ä¸ªç‰¹æ®Šçš„VS Codeå¯ä»¥ç”¨æ¥åŠ è½½æœ¬åœ°èµ„æºå­é›†çš„URI

æƒ³è±¡æˆ‘ä»¬æƒ³è¦å¼€å§‹æ‰“åŒ…çŒ«çš„GIFåˆ°æˆ‘ä»¬çš„æ‰©å±•ä¸­ï¼Œè€Œä¸æ˜¯ä»Giphyæ‹‰å–ã€‚ä¸ºäº†åšåˆ°è¿™ä¸ªï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæŒ‡å‘ç£ç›˜ä¸Šçš„æ–‡ä»¶çš„URIï¼Œç„¶åä¼ é€’è¿™äº›URIç»™`asWebviewUri`å‡½æ•°

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {}
      );

      // è·å–ç£ç›˜ä¸Šèµ„æºçš„è·¯å¾„
      const onDiskPath = vscode.Uri.joinPath(context.extensionUri, 'media', 'cat.gif');

      // ç„¶åè·å–Webviewä½¿ç”¨çš„ç‰¹æ®Šçš„URI
      const catGifSrc = panel.webview.asWebviewUri(onDiskPath);

      panel.webview.html = getWebviewContent(catGifSrc);
    })
  );
}
```

å¦‚æœæˆ‘ä»¬è°ƒè¯•è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°`catGifSrc`å®é™…çš„å€¼å°±åƒï¼š
```txt
vscode-resource:/Users/toonces/projects/vscode-cat-coding/media/cat.gif
```

VS Codeç†è§£è¿™ä¸ªç‰¹æ®Šçš„URIå¹¶ä¸”å°†ç”¨å®ƒæ¥ä»ç£ç›˜ä¸ŠåŠ è½½èµ„æº

Webviewé»˜è®¤åªèƒ½è®¿é—®ä¸‹åˆ—ä½ç½®çš„èµ„æº:

- åœ¨æ‚¨çš„æ‰©å±•å®‰è£…ç›®å½•
- åœ¨ç”¨æˆ·å½“å‰å¯ç”¨çš„å·¥ä½œç©ºé—´

ä½¿ç”¨`WebviewOptions.localResourcesRoots`å…è®¸è®¿é—®å…¶ä»–çš„æœ¬åœ°èµ„æº

æ‚¨åŒæ ·å¯ä»¥ä¸€ç›´ä½¿ç”¨æ•°æ®URIç›´æ¥åµŒå…¥URIåˆ°Webè§†å›¾

### æ§åˆ¶æœ¬åœ°èµ„æºçš„è®¿é—®

Webviewä½¿ç”¨`localResourceRoots`é€‰é¡¹æ§åˆ¶å¯ä»¥ä»ç”¨æˆ·è®¾å¤‡åŠ è½½å“ªä¸ªèµ„æºã€‚`localResourceRoots`å®šä¹‰äº†ä¸€ç»„å¯èƒ½è¢«åŠ è½½çš„æœ¬åœ°å†…å®¹æ ¹URI

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`localResourceRoots`é™åˆ¶**Cat Coding**Webè§†å›¾åªåŠ è½½æˆ‘ä»¬æ‰©å±•ä¸­çš„`media`æ–‡ä»¶å¤¹ä¸­çš„æœ¬åœ°èµ„æº

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {
          // åªå…è®¸Webè§†å›¾è®¿é—®æˆ‘ä»¬æ‰©å±•ä¸­mediaæ–‡ä»¶å¤¹çš„èµ„æº
          localResourceRoots: [vscode.Uri.joinPath(context.extensionPath, 'media')]
        }
      );

      const onDiskPath = vscode.Uri.joinPath(context.extensionUri, 'media', 'cat.gif');
      const catGifSrc = panel.webview.asWebviewUri(onDiskPath);

      panel.webview.html = getWebviewContent(catGifSrc);
    })
  );
}
```

è¦ç¦æ­¢æ‰€æœ‰æœ¬åœ°èµ„æºï¼Œåªéœ€è®¾ç½®`localResourceRoots`ä¸º`[]`

é€šå¸¸ï¼ŒWebè§†å›¾åº”è¯¥å°½å¯èƒ½é™åˆ¶åŠ è½½æœ¬åœ°èµ„æºã€‚ç„¶è€Œï¼Œè¯·è®°ä½åªæœ‰`localResourceRoots`ä¸ä¼šæä¾›å®Œå…¨çš„å®‰å…¨ä¿æŠ¤ã€‚ç¡®ä¿æ‚¨çš„Webè§†å›¾ä¹Ÿéµå®ˆ[æœ€å¥½çš„å®‰å…¨ç»ƒä¹ ](#å®‰å…¨)ï¼Œå¹¶ä¸”æ·»åŠ ä¸€ä¸ª[å†…å®¹å®‰å…¨æ”¿ç­–](#å†…å®¹å®‰å…¨æ”¿ç­–)æ¥è¿›ä¸€æ­¥é™åˆ¶å¯ä»¥åŠ è½½çš„å†…å®¹

### Webè§†å›¾å†…å®¹ä¸»é¢˜åŒ–

Webè§†å›¾å¯ä»¥ä½¿ç”¨CSSä¾æ®å½“å‰VS Codeçš„ä¸»é¢˜æ”¹å˜å®ƒä»¬çš„å¤–è§‚ã€‚VS Codeå°†ä¸»é¢˜åˆ†ä¸ºä¸‰ç±»ï¼Œå¹¶ä¸”æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„ç±»ç»™`body`å…ƒç´ æ¥è¡¨æ˜å½“å‰ä¸»é¢˜

- `vscode-light` - æµ…è‰²ä¸»é¢˜
- `vscode-dark` - æ·±è‰²ä¸»é¢˜
- `vscode-high-contrast` - é«˜å¯¹æ¯”åº¦ä¸»é¢˜

ä¸‹é¢çš„CSSä¾æ®ç”¨æˆ·å½“å‰ä¸»é¢˜æ›´æ”¹Webè§†å›¾æ–‡æœ¬é¢œè‰²

```css
body.vscode-light {
  color: black;
}

body.vscode-dark {
  color: white;
}

body.vscode-high-contrast {
  color: red;
}
```

å½“å¼€å‘ä¸€ä¸ªWebè§†å›¾åº”ç”¨ç¨‹åºæ—¶ï¼Œç¡®ä¿å®ƒå¯ä»¥åœ¨ä¸‰ç§ä¸»é¢˜ä¸‹æ­£å¸¸è¿è¡Œã€‚å¹¶ä¸”ä¿æŒæµ‹è¯•æ‚¨çš„Webè§†å›¾é«˜å¯¹æ¯”åº¦æ¨¡å¼ç¡®ä¿å®ƒèƒ½å¤Ÿè¢«è§†è§‰éšœç¢è€…ä½¿ç”¨

Webè§†å›¾ä¹Ÿå¯ä»¥ä½¿ç”¨[CSSå˜é‡](https://developer.mozilla.org/docs/Web/CSS/Using_CSS_variables)è®¿é—®VS Codeçš„ä¸»é¢˜é¢œè‰²ã€‚è¿™äº›å˜é‡åç§°æ‹¥æœ‰`vscode`å‰ç¼€å¹¶ä¸”ä½¿ç”¨`-`æ›¿æ¢`.`ã€‚ä¾‹å¦‚ï¼Œ `editor.foreground`å˜æˆäº†`var(--vscode-editor-foreground)`ï¼š

```css
code {
  color: var(--vscode-editor-foreground);
}
```

æŸ¥é˜…[ä¸»é¢˜é¢œè‰²å‚è€ƒ](/9.%20å‚è€ƒ/7.%20ä¸»é¢˜é¢œè‰².md)äº†è§£å¯ç”¨çš„ä¸»é¢˜å˜é‡ã€‚[ä¸€ä¸ªæ‰©å±•]æä¾›äº†å¯ç”¨çš„å˜é‡æ™ºèƒ½æ„ŸçŸ¥å»ºè®®

åŒæ ·å®šä¹‰äº†ä¸‹åˆ—å­—ä½“ç›¸å…³å˜é‡ï¼š

- `--vscode-editor-font-family` - ç¼–è¾‘å™¨ï¼ˆ`editor.fontFamily`è®¾ç½®ï¼‰çš„å­—æ—
- `--vscode-editor-font-weight` - ç¼–è¾‘å™¨ï¼ˆ`editor.fontWeight`è®¾ç½®ï¼‰çš„å­—é‡
- `--vscode-editor-font-size` - ç¼–è¾‘å™¨ï¼ˆ`editor.fontSize`è®¾ç½®ï¼‰çš„å­—ä½“å°ºå¯¸

æœ€åï¼Œå¯¹äºæ‚¨éœ€è¦å•ç‹¬å†™ä¸€ä¸ªCSSç»™ä¸€ä¸ªä¸»é¢˜ä½¿ç”¨çš„ç‰¹æ®Šæƒ…å†µï¼ŒWebè§†å›¾çš„ä¸»ä½“å…ƒç´ å…·æœ‰ä¸€ä¸ªå«åš`vscode-theme-id`å­˜å‚¨å½“å‰ä½¿ç”¨ä¸»é¢˜IDçš„æ•°æ®å±æ€§ã€‚è¿™å…è®¸æ‚¨ç»™Webè§†å›¾å†™ç‰¹å®šçš„ä¸»é¢˜CSS

```css
body[data-vscode-theme-id="One Dark Pro"] {
    background: hotpink;
}
```

### æ”¯æŒçš„åª’ä½“æ ¼å¼

Webè§†å›¾æ”¯æŒéŸ³é¢‘å’Œè§†é¢‘ï¼Œç„¶è€Œä¸æ˜¯æ¯ç§åª’ä½“è§£ç å™¨æˆ–åª’ä½“æ–‡ä»¶å®¹å™¨ç±»å‹éƒ½å—æ”¯æŒ

ä¸‹åˆ—æ˜¯å¯ä»¥åœ¨Webè§†å›¾ä¸­ä½¿ç”¨çš„éŸ³é¢‘æ ¼å¼ï¼š

- Wac
- Mp3
- Ogg
- Flac

ä¸‹åˆ—æ˜¯å¯ä»¥åœ¨Webè§†å›¾ä½¿ç”¨çš„è§†é¢‘æ ¼å¼

- H.264
- VP8

å¯¹äºè§†é¢‘æ–‡ä»¶ï¼Œç¡®ä¿è§†é¢‘å’ŒéŸ³é¢‘è½¨é“åª’ä½“æ ¼å¼éƒ½å—æ”¯æŒã€‚ä¾‹å¦‚è®¸å¤š`.mp4`æ–‡ä»¶ä½¿ç”¨`H.264`è§†é¢‘å’Œ`AAC`éŸ³é¢‘ã€‚VS Codeå°†ä¼šæ’­æ”¾`mp4`çš„è§†é¢‘éƒ¨åˆ†ï¼Œä½†å› ä¸º`AAC`éŸ³é¢‘ä¸å—æ”¯æŒï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•å£°éŸ³ã€‚æ‚¨éœ€è¦ä½¿ç”¨`mp4`éŸ³é¢‘è½¨é“æ›¿ä»£

### ä¸Šä¸‹æ–‡èœå•

è¿›é˜¶çš„Webè§†å›¾å¯ä»¥è‡ªå®šä¹‰å½“ç”¨æˆ·å³å‡»ä¸€ä¸ªWebè§†å›¾å†…æ˜¾ç¤ºçš„ä¸Šä¸‹æ–‡èœå•ã€‚è¿™é€šè¿‡ä¸€ä¸ªç±»ä¼¼äºVS Codeæ™®é€šä¸Šä¸‹æ–‡èœå•çš„[è´¡çŒ®ç‚¹](/9.%20å‚è€ƒ/2.%20è´¡çŒ®ç‚¹.md)åšåˆ°ï¼Œæ‰€ä»¥è‡ªå®šä¹‰èœå•é€‚ç”¨äºç¼–è¾‘å™¨çš„å…¶ä»–åœ°æ–¹ã€‚Webè§†å›¾ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„éƒ¨åˆ†æ˜¾ç¤ºè‡ªå®šä¹‰ä¸Šä¸‹æ–‡èœå•

ä¸ºäº†æ·»åŠ ä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡èœå•åˆ°æ‚¨çš„Webè§†å›¾ã€‚é¦–å…ˆåœ¨`webview/context`å­—æ®µä¸‹çš„`menus`æ·»åŠ ä¸€ä¸ªæ–°çš„å…¥å£ã€‚æ¯ä¸ªè´¡çŒ®éœ€è¦ä¸€ä¸ª`command`ï¼ˆåŒæ ·æ˜¯é¡¹ç›®æ ‡é¢˜æ‰€æ¥ä¹‹å¤„ï¼‰å’Œä¸€ä¸ª`when`(æ—¶é—´çŠ¶è¯­)ã€‚[æ—¶é—´çŠ¶è¯­](/9.%20å‚è€ƒ/6.%20æ—¶é—´çŠ¶è¯­ä¸Šä¸‹æ–‡.md)åŒ…æ‹¬`webviewId == 'YOUR_WEBVIEW_VIEW_TYPE'`æ¥ç¡®ä¿ä¸Šä¸‹æ–‡èœå•åªåº”ç”¨åœ¨æ‚¨çš„æ‰©å±•çš„Webè§†å›¾
```json
"contributes": {
  "menus": {
    "webview/context": [
      {
        "command": "catCoding.yarn",
        "when": "webviewId == 'catCoding'"
      },
      {
        "command": "catCoding.insertLion",
        "when": "webviewId == 'catCoding' && webviewSection == 'editor'"
      }
    ]
  },
  "commands": [
    {
      "command": "catCoding.yarn",
      "title": "Yarn ğŸ§¶",
      "category": "Cat Coding"
    },
    {
      "command": "catCoding.insertLion",
      "title": "Insert ğŸ¦",
      "category": "Cat Coding"
    },
    ...
  ]
}
```
åœ¨Webè§†å›¾ä¸­ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨`data-vscode-context`[æ•°æ®å±æ€§](https://developer.mozilla.org/docs/Learn/HTML/Howto/Use_data_attributes)ï¼ˆæˆ–åœ¨JavaScriptä½¿ç”¨`dataset.vscodeContext`ï¼‰ä¸ºHTMLçš„æŒ‡å®šåŒºåŸŸè®¾ç½®ä¸Šä¸‹æ–‡ã€‚`data-vscode-context`å€¼ä¸ºä¸€ä¸ªæŒ‡å®šäº†è®¾ç½®ä»€ä¹ˆæ—¶å€™ç”¨æˆ·å³å‡»å…ƒç´ çš„ä¸Šä¸‹æ–‡JSONå¯¹è±¡ã€‚æœ€ç»ˆçš„ä¸Šä¸‹æ–‡æ˜¯ç”±ä»æ–‡æ¡£æ ¹éƒ¨åˆ°ç‚¹å‡»çš„å…ƒç´ ç¡®å®šçš„

ä¾‹å¦‚è€ƒè™‘è¿™ä¸ªHTMLï¼š
```html
<div class="main" data-vscode-context='{"webviewSection": "main", "mouseCount": 4}'>
  <h1>Cat Coding</h1>

  <textarea data-vscode-context='{"webviewSection": "editor", "preventDefaultContextMenuItems": true}'></textarea>
</div>
```

å¦‚æœç”¨æˆ·å³å‡»`textarea`ï¼Œä¸‹åˆ—ä¸Šä¸‹æ–‡å°†è¢«è®¾ç½®

- `webviewSection == 'editor'` - è¿™ä¸ªä»çˆ¶å…ƒç´ é‡è½½`webviewSection`
- `mouseCount == 4` - è¿™ä¸ªä»çˆ¶ç±»é›†æˆ
- `preventDefaultContextMenuItems == true` - è¿™æ˜¯éšè—VS Codeé»˜è®¤åŠ å…¥åˆ°Webè§†å›¾ä¸Šä¸‹æ–‡èœå•çš„å¤åˆ¶ç²˜è´´å…¥å£çš„ç‰¹æ®Šä¸Šä¸‹æ–‡

å¦‚æœç”¨æˆ·å³å‡»`<textarea>`å†…ï¼Œä»–ä»¬å°†çœ‹åˆ°

![](https://code.visualstudio.com/assets/api/extension-guides/webview/webview-context-menus.png)

æœ‰æ—¶å®ƒå¯ä»¥åœ¨å·¦é”®å±•ç¤ºä¸€ä¸ªèœå•å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨åˆ†å‰²æŒ‰é’®æ˜¾ç¤ºä¸€ä¸ªèœå•ã€‚æ‚¨å¯ä»¥å¦‚ä¸‹é€šè¿‡åœ¨ä¸€ä¸ª`onClick`äº‹ä»¶å‘é€`contextmenu`äº‹ä»¶åšåˆ°

```html
<button data-vscode-context='{"preventDefaultContextMenuItems": true } onClick={(e) => {
        e.preventDefault();
        e.target.dispatchEvent(new MouseEvent('contextmenu', { bubbles: true, clientX: e.clientX, clientY: e.clientY }));
        e.stopPropagation();
    }}>Create</button>
```

![](https://code.visualstudio.com/assets/api/extension-guides/webview/webview-split-button-menu.png)

## è„šæœ¬ä¸æ¶ˆæ¯ä¼ é€’

Webè§†å›¾å°±åƒå†…åµŒæ¡†æ¶ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¹Ÿå¯ä»¥è¿è¡Œè„šæœ¬ã€‚JavaScripté»˜è®¤åœ¨Webè§†å›¾ä¸­ç¦ç”¨ï¼Œä½†å¯ä»¥è½»æ¾åœ°é€šè¿‡ä¼ é€’`enableScripts: true`é€‰é¡¹é‡æ–°å¯ç”¨

è®©æˆ‘ä»¬ä½¿ç”¨è„šæœ¬æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨è¿½è¸ªæˆ‘ä»¬çš„çŒ«å·²ç»ç¼–å†™çš„æºä»£ç è¡Œæ•°ã€‚è¿è¡Œä¸€ä¸ªåŸºæœ¬çš„è„šæœ¬ååˆ†ç®€å•ï¼Œä½†æ˜¯æ³¨æ„è¿™ä¸ªä¾‹å­åªç”¨äºæ¼”ç¤ºç”¨é€”ã€‚ä½œä¸ºç»ƒä¹ ï¼Œæ‚¨çš„Webè§†å›¾åº”å½“ä¸€ç›´é‡‡ç”¨[å†…å®¹å®‰å…¨åè®®](#å†…å®¹å®‰å…¨åè®®)ç¦ç”¨å†…åµŒè„šæœ¬ï¼š

```typescript
import * as path from 'path';
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {
          // åœ¨Webè§†å›¾ä¸­å¯ç”¨è„šæœ¬
          enableScripts: true
        }
      );

      panel.webview.html = getWebviewContent();
    })
  );
}

function getWebviewContent() {
  return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Coding</title>
</head>
<body>
    <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" />
    <h1 id="lines-of-code-counter">0</h1>

    <script>
        const counter = document.getElementById('lines-of-code-counter');

        let count = 0;
        setInterval(() => {
            counter.textContent = count++;
        }, 100);
    </script>
</body>
</html>`;
}
```

![](https://code.visualstudio.com/assets/api/extension-guides/webview/scripts-basic.gif)

å“‡ï¼é‚£æ˜¯åªå‹¤åŠ³çš„çŒ«

Webè§†å›¾è„šæœ¬å¯ä»¥åšä»»ä½•æ™®é€šç½‘é¡µè„šæœ¬èƒ½åšçš„äº‹æƒ…ã€‚ç‰¢è®°äºå¿ƒWebè§†å›¾åœ¨å®ƒä»¬è‡ªå·±çš„ç¯å¢ƒä¸­å­˜åœ¨ï¼Œæ‰€ä»¥Webè§†å›¾ä¸­çš„è„šæœ¬æ²¡æœ‰æƒé™è®¿é—®VS Code APIã€‚è¿™å°±æ˜¯æ¶ˆæ¯ä¼ é€’çš„ç”±æ¥

## ä»æ‰©å±•ä¼ é€’æ¶ˆæ¯åˆ°ä¸€ä¸ªWebè§†å›¾

ä¸€ä¸ªæ‰©å±•å¯ä»¥ä½¿ç”¨`webview.postMessage()`å‘é€æ•°æ®ç»™å®ƒçš„Webè§†å›¾ã€‚è¿™ä¸ªæ–¹æ³•å‘é€ä»»ä½•JSONåºåˆ—åŒ–æ•°æ®ç»™Webå®ä½“ã€‚è¿™ä¸ªæ¶ˆæ¯åœ¨Webè§†å›¾ä¸­é€šè¿‡æ ‡å‡†`message`äº‹ä»¶æ¥æ”¶

ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªï¼Œè®©æˆ‘ä»¬ç»™**Cat Coding**æ·»åŠ ä¸€ä¸ªæ–°å‘½ä»¤å‘½ä»¤å½“å‰çš„ç¼–ç¨‹çŒ«æ¥é‡æ„å®ƒä»¬çš„ä»£ç ï¼ˆä»è€Œé™ä½æ€»è¡Œæ•°ï¼‰ã€‚æ–°çš„`catCoding.doRefactor`å‘½ä»¤ä½¿ç”¨`postMessage`æ¥å‘é€æŒ‡ä»¤ç»™å½“å‰çš„Webè§†å›¾ï¼ŒWebè§†å›¾æœ¬èº«çš„`window.addEventListener('message', event => { ... })`æ¥æ”¶æ¶ˆæ¯ï¼š

```typescript
export function activate(context: vscode.ExtensionContext) {
  // åªå…è®¸å•ä¸ªç¨‹åºå‘˜çŒ«
  let currentPanel: vscode.WebviewPanel | undefined = undefined;

  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      if (currentPanel) {
        currentPanel.reveal(vscode.ViewColumn.One);
      } else {
        currentPanel = vscode.window.createWebviewPanel(
          'catCoding',
          'Cat Coding',
          vscode.ViewColumn.One,
          {
            enableScripts: true
          }
        );
        currentPanel.webview.html = getWebviewContent();
        currentPanel.onDidDispose(
          () => {
            currentPanel = undefined;
          },
          undefined,
          context.subscriptions
        );
      }
    })
  );

  // æˆ‘ä»¬çš„æ–°å‘½ä»¤
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.doRefactor', () => {
      if (!currentPanel) {
        return;
      }

      // ç»™æˆ‘ä»¬çš„Webèº«ä½“å‘é€ä¸€æ¡æ¶ˆæ¯
      // ä½ å¯ä»¥å‘é€ä»»ä½•JSONåºåˆ—åŒ–æ•°æ®
      currentPanel.webview.postMessage({ command: 'refactor' });
    })
  );
}

function getWebviewContent() {
  return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Coding</title>
</head>
<body>
    <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" />
    <h1 id="lines-of-code-counter">0</h1>

    <script>
        const counter = document.getElementById('lines-of-code-counter');

        let count = 0;
        setInterval(() => {
            counter.textContent = count++;
        }, 100);

        // åœ¨Webè§†å›¾ä¸­æ¥æ”¶æ¶ˆæ¯
        window.addEventListener('message', event => {

            const message = event.data; // æˆ‘ä»¬æ‰©å±•å‘é€çš„JSONæ•°æ®

            switch (message.command) {
                case 'refactor':
                    count = Math.ceil(count * 0.5);
                    counter.textContent = count;
                    break;
            }
        });
    </script>
</body>
</html>`;
}
```

![](https://code.visualstudio.com/assets/api/extension-guides/webview/scripts-extension_to_webview.gif)

# ä»ä¸€ä¸ªWebè§†å›¾ä¼ é€’æ¶ˆæ¯ç»™æ‰©å±•

Webè§†å›¾ä¹Ÿå¯ä»¥ä¼ é€’æ¶ˆæ¯å›ç»™æ‰©å±•ã€‚è¿™å¯ä»¥åœ¨Webè§†å›¾å†…çš„ç‰¹æ®ŠVS Code APIå¯¹è±¡ä½¿ç”¨`postMessage`å‡½æ•°å®ç°ã€‚ä¸ºäº†è®¿é—®VS Code APIå¯¹è±¡ï¼Œåœ¨Webè§†å›¾ä¸­è°ƒç”¨`acquireVsCodeApi`ã€‚è¿™ä¸ªå‡½æ•°ä¸€æ®µæ—¶é—´å†…ä»…èƒ½è°ƒç”¨ä¸€æ¬¡ã€‚æ‚¨å¿…é¡»ç´§ç´§æŠŠæ¡ä½è¿™ä¸ªæ–¹æ³•è¿”å›çš„VS Code APIå®ä¾‹ï¼Œå¹¶ä¸”å°†å…¶ä¼ é€’åˆ°ä»»ä½•æ‚¨éœ€è¦ä½¿ç”¨çš„å‡½æ•°ä¸­

å½“æˆ‘ä»¬çš„çŒ«åœ¨ä»£ç ä¸­é‡åˆ°ä¸€ä¸ªæ¼æ´æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„**Cat Coding**Webè§†å›¾ä¸­ä½¿ç”¨VS Code APIå’Œ`postMessage`æ¥å‘æ‰©å±•æŠ¥è­¦

```typescript
export function activate(context: vscode.ExtensionContext) {
  context.subscriptions.push(
    vscode.commands.registerCommand('catCoding.start', () => {
      const panel = vscode.window.createWebviewPanel(
        'catCoding',
        'Cat Coding',
        vscode.ViewColumn.One,
        {
          enableScripts: true
        }
      );

      panel.webview.html = getWebviewContent();

      // ä»Webè§†å›¾ä¼ é€’æ¶ˆæ¯
      panel.webview.onDidReceiveMessage(
        message => {
          switch (message.command) {
            case 'alert':
              vscode.window.showErrorMessage(message.text);
              return;
          }
        },
        undefined,
        context.subscriptions
      );
    })
  );
}

function getWebviewContent() {
  return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Coding</title>
</head>
<body>
    <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" width="300" />
    <h1 id="lines-of-code-counter">0</h1>

    <script>
        (function() {
            const vscode = acquireVsCodeApi();
            const counter = document.getElementById('lines-of-code-counter');

            let count = 0;
            setInterval(() => {
                counter.textContent = count++;

                // å½“æˆ‘ä»¬çš„çŒ«é‡åˆ°æ¼æ´æ—¶å‘æ‰©å±•æŠ¥è­¦
                if (Math.random() < 0.001 * count) {
                    vscode.postMessage({
                        command: 'alert',
                        text: 'ğŸ›  on line ' + count
                    })
                }
            }, 100);
        }())
    </script>
</body>
</html>`;
}
```

![](https://code.visualstudio.com/assets/api/extension-guides/webview/scripts-webview_to_extension.gif)

å‡ºäºå®‰å…¨åŸå› ï¼Œæ‚¨å¿…é¡»ä¿æŒVS Code APIå¯¹è±¡ç§æœ‰å¹¶ä¸”ç¡®ä¿å®ƒä¸ä¼šæ³„éœ²åˆ°å…¨å±€

### ä½¿ç”¨Webå·¥ä½œè€…

Webè§†å›¾ä¸­æ”¯æŒ[Webå·¥ä½œè€…](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers)ï¼Œä½†ä»æœ‰äº›é™åˆ¶éœ€æ³¨æ„

é¦–å…ˆï¼Œå·¥ä½œè€…ä»…ä½¿ç”¨å®ƒä»¬çš„`data:`æˆ–`blob:`çš„URIæ—¶åŠ è½½ã€‚æ‚¨ä¸å¯ä»¥ç›´æ¥åœ¨æ‰©å±•æ–‡ä»¶å¤¹ä¸­åŠ è½½ä¸€ä¸ªå·¥ä½œè€…

å¦‚æœæ‚¨éœ€è¦åœ¨æ‚¨çš„æ‰©å±•ä¸­ä»JavaScriptæ–‡ä»¶åŠ è½½å·¥ä½œè€…ä»£ç ï¼Œè¯•è¯•ä½¿ç”¨`fetch:`ï¼š

```typescript
const workerSource = 'absolute/path/to/worker.js';

fetch(workerSource)
  .then(result => result.blob())
  .then(blob => {
    const blobUrl = URL.createObjectURL(blob);
    new Worker(blobUrl);
  });
```

å·¥ä½œè€…è„šæœ¬åŒæ ·ä¸æ”¯æŒä½¿ç”¨`importScripts`æˆ–`import(...)`å¯¼å…¥æºä»£ç ã€‚å¦‚æœæ‚¨çš„å·¥ä½œè€…åŠ¨æ€åŠ è½½ä»£ç ï¼Œè¯•è¯•ä½¿ç”¨å¦‚`webpack`çš„æ‰“åŒ…å™¨æ¥æ‰“åŒ…å·¥ä½œè€…è„šæœ¬ä¸ºå•ä¸ªæ–‡ä»¶

æ‚¨å¯ä»¥é€šè¿‡`LimitChunkCountPlugin`æ¥åœ¨ä½¿ç”¨`webpack`æ—¶å¼ºåˆ¶åŠ è½½å·²ç¼–è¯‘å·¥ä½œè€…JavaScriptä¸ºå•ä¸ªæ–‡ä»¶

```typescript
const path = require('path');
const webpack = require('webpack');

module.exports = {
  target: 'webworker',
  entry: './worker/src/index.js',
  output: {
    filename: 'worker.js',
    path: path.resolve(__dirname, 'media')
  },
  plugins: [
    new webpack.optimize.LimitChunkCountPlugin({
      maxChunks: 1
    })
  ]
};
```

## å®‰å…¨

ä¸ä»»ä½•ç½‘é¡µä¸€æ ·ï¼Œå½“åˆ›å»ºä¸€ä¸ªWebè§†å›¾æ—¶ï¼Œæ‚¨å¿…é¡»è·Ÿéšä¸€äº›æœ€å¥½çš„å®‰å…¨åŸºç¡€ç»ƒä¹ 

### é™åˆ¶èƒ½åŠ›

ä¸€ä¸ªWebè§†å›¾åº”æœ€å°ä¸€å¥—å…¶éœ€è¦çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„Webè§†å›¾ä¸éœ€è¦è¿è¡Œè„šæœ¬ï¼Œä¸è¦è®¾ç½®`enableScripts: true`ã€‚å¦‚æœæ‚¨çš„Webè§†å›¾ä¸éœ€è¦ä»ç”¨æˆ·å·¥ä½œç©ºé—´åŠ è½½èµ„æºï¼Œè®¾ç½®`localResourceRoot`ä¸º`[vscode.Uri.file(extensionContext.extensionPath)]`æˆ–ç”šè‡³`[]`æ¥ç¦ç”¨æ‰€æœ‰æœ¬åœ°èµ„æºçš„è®¿é—®

### å†…å®¹å®‰å…¨åè®®

[å†…å®¹å®‰å…¨åè®®](https://developers.google.com/web/fundamentals/security/csp/)æ›´æ·±å…¥åœ°é™åˆ¶äº†Webè§†å›¾ä¸­å¯ä»¥åŠ è½½å’Œæ‰§è¡Œçš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå†…å®¹å®‰å…¨åè®®å¯ä»¥ç¡®ä¿åªæœ‰ä¸€ç³»åˆ—å…è®¸çš„è„šæœ¬å¯ä»¥åœ¨Webè§†å›¾ä¸­è¿è¡Œï¼Œæˆ–ç”šè‡³å‘Šè¯‰Webè§†å›¾åªåŠ è½½`https`ä¸‹çš„å›¾åƒ

è¦æ·»åŠ ä¸€ä¸ªå†…å®¹å®‰å…¨åè®®ï¼Œåœ¨Webè§†å›¾`<head>`é¡¶éƒ¨æ”¾å…¥ä¸€ä¸ª`<meta http-equiv="Content-Security-Policy">`æŒ‡ä»¤

```typescript
function getWebviewContent() {
  return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta http-equiv="Content-Security-Policy" content="default-src 'none';">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Cat Coding</title>
</head>
<body>
    ...
</body>
</html>`;
}
```

åè®®`default-src 'none';`ç¦ç”¨æ‰€æœ‰å†…å®¹ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ä¹‹å˜å›æˆ‘ä»¬æ‰©å±•å·¥ä½œæ‰€éœ€çš„æœ€å°‘å†…å®¹ã€‚è¿™é‡Œæ˜¯å…è®¸åŠ è½½æœ¬åœ°è„šæœ¬å’Œæ ·å¼è¡¨å¹¶åŠ è½½`https`ä¸‹å›¾åƒçš„å†…å®¹å®‰å…¨åè®®

```html
<meta
  http-equiv="Content-Security-Policy"
  content="default-src 'none'; img-src ${webview.cspSource} https:; script-src ${webview.cspSource}; style-src ${webview.cspSource};"
/>
```

`${webview.cspSource}`å€¼æ˜¯æ¥è‡ªWebviewæœ¬èº«çš„å€¼çš„å ä½ç¬¦ã€‚å‚é˜…[Webè§†å›¾ç¤ºä¾‹](https://github.com/microsoft/vscode-extension-samples/blob/main/webview-sample)è·å¾—å¦‚ä½•ä½¿ç”¨æ­¤å€¼çš„å®Œæ•´ç¤ºä¾‹

è¿™ä¸ªå†…å®¹å®‰å…¨åè®®åŒæ ·å®Œå…¨ç¦ç”¨äº†å†…è”è„šæœ¬å’Œæ ·å¼è¡¨ã€‚å¼•ç”¨æ‰€æœ‰çš„å†…è”è„šæœ¬å’Œæ ·å¼è¡¨åˆ°å¤–éƒ¨æ–‡ä»¶æ˜¯ä¸€ä¸ªæœ€ä½³å®è·µï¼Œä»¥æ­¤æ¥ä½¿å®ƒä»¬å¯ä»¥åœ¨ä¸æ”¾å®½å†…å®¹å®‰å…¨åè®®æ—¶æ­£ç¡®åŠ è½½

### ä»…åŠ è½½httpsä¸‹çš„å†…å®¹

å¦‚æœæ‚¨çš„Webè§†å›¾å…è®¸åŠ è½½å¤–éƒ¨èµ„æºï¼Œå¼ºçƒˆå»ºè®®æ‚¨åªå…è®¸è¿™äº›èµ„æºåœ¨`https`è€Œä¸æ˜¯`http`ä¸‹åŠ è½½ã€‚ä¸Šé¢çš„ç¤ºä¾‹å†…å®¹å®‰å…¨åè®®å·²ç»é€šè¿‡åªå…è®¸åŠ è½½`https`ä¸‹çš„å›¾åƒè¿™ä¹ˆåšäº†

### æ— å®³åŒ–æ‰€æœ‰ç”¨æˆ·è¾“å…¥

å°±åƒä½ å¯¹ä¸€ä¸ªæ™®é€šç½‘é¡µä¼šåšçš„ä¸€æ ·ï¼Œå½“ä¸ºWebè§†å›¾æ„é€ HTMLæ—¶ï¼Œæ‚¨å¿…é¡»æ— å®³åŒ–æ‰€æœ‰ç”¨æˆ·è¾“å…¥ã€‚å¦‚æœä¸èƒ½æ­£ç¡®æ— å®³åŒ–è¾“å…¥ï¼Œå¯èƒ½å…è®¸å°†å¯¼è‡´ç”¨æˆ·é¢ä¸´å®‰å…¨é£é™©çš„å†…å®¹æ³¨å…¥

å¿…é¡»é‡è§†æ— å®³åŒ–ç¤ºä¾‹ï¼š

- æ–‡ä»¶å†…å®¹
- æ–‡ä»¶ä¸æ–‡ä»¶å¤¹è·¯å¾„
- ç”¨æˆ·å’Œå·¥ä½œç©ºé—´è®¾ç½®

è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªå¸®åŠ©åº“æ¥æ„é€ æ‚¨çš„HTMLå­—ç¬¦ä¸²ï¼Œæˆ–è‡³å°‘ç¡®ä¿æ‰€æœ‰æ¥è‡ªç”¨æˆ·å·¥ä½œç©ºé—´çš„å†…å®¹æ­£ç¡®æ— å®³åŒ–

æ°¸è¿œä¸è¦åœ¨å®‰å…¨ä¸Šåªä¾èµ–æ— å®³åŒ–ã€‚ç¡®ä¿éµå®ˆå…¶ä»–çš„åˆé€‚çš„å®‰å…¨ä¹ æƒ¯ï¼Œä¾‹å¦‚æ‹¥æœ‰ä¸€ä¸ª [å†…å®¹å®‰å…¨åè®®](#å†…å®¹å®‰å…¨åè®®)æ¥æœ€å°åŒ–ä»»ä½•å¯èƒ½çš„å†…å®¹æ³¨å…¥çš„å½±å“

## ä¿æŒ

åœ¨æ ‡å‡†Webè§†å›¾[ç”Ÿå‘½å‘¨æœŸ](#ç”Ÿå‘½å‘¨æœŸ)ï¼ŒWebè§†å›¾ç”±`createWebviewPanel`åˆ›å»ºå¹¶ä¸”ç”±`.dispose()`è°ƒç”¨æˆ–ç”¨æˆ·å…³é—­å®ƒä»¬æ—¶é”€æ¯ã€‚ç„¶è€ŒWebè§†å›¾å†…å®¹æ˜¯åœ¨å½“Webè§†å›¾å˜å¯è§æ—¶åˆ›å»ºï¼ŒWebè§†å›¾ç§»è‡³åå°æ—¶é”€æ¯ã€‚å½“Webè§†å›¾ç§»åŠ¨è‡³åå°æ æ—¶ï¼Œä»»ä½•Webè§†å›¾å†…çŠ¶æ€å°†ä¸¢å¤±

æœ€å¥½çš„è§£å†³è¿™ä¸ªçš„åŠæ³•æ˜¯æ—¶ä½ çš„Webè§†å›¾æ— çŠ¶æ€ã€‚ä½¿ç”¨[æ¶ˆæ¯ä¼ é€’](#è„šæœ¬ä¸æ¶ˆæ¯ä¼ é€’)æ¥ä¿å­˜Webè§†å›¾çš„çŠ¶æ€ï¼Œç„¶ååœ¨Webè§†å›¾å†æ¬¡å¯è§æ—¶æ¢å¤çŠ¶æ€

### getStateä¸setState

åœ¨Webè§†å›¾å†…è¿è¡Œçš„è„šæœ¬å¯ä»¥ä½¿ç”¨`getState`å’Œ`setState`æ–¹æ³•æ¥ä¿å­˜å¹¶æ¢å¤æˆä¸€ä¸ªJSONå¯åºåˆ—åŒ–çŠ¶æ€å¯¹è±¡ã€‚è¿™ä¸ªçŠ¶æ€ç”šè‡³åœ¨Webè§†å›¾é¢æ¿å˜ä¸ºéšè—ï¼ŒWebè§†å›¾å†…å®¹æœ¬èº«é”€æ¯æ—¶ä¿æŒã€‚çŠ¶æ€åœ¨Webè§†å›¾é¢æ¿é”€æ¯æ—¶é”€æ¯

```typescript
// åœ¨Webè§†å›¾è„šæœ¬å½“ä¸­
const vscode = acquireVsCodeApi();

const counter = document.getElementById('lines-of-code-counter');

// æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰æ—§çŠ¶æ€æ¥æ¢å¤
const previousState = vscode.getState();
let count = previousState ? previousState.count : 0;
counter.textContent = count;

setInterval(() => {
  counter.textContent = count++;
  // æ›´æ–°ä¿å­˜çš„çŠ¶æ€
  vscode.setState({ count });
}, 100);
```

`getState`å’Œ`setState`æ˜¯æ›´å—å–œçˆ±ä¿æŒçŠ¶æ€çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬æœ‰æ¯”`retainContextWhenHidden`æ›´ä½çš„æ€§èƒ½å¼€æ”¯