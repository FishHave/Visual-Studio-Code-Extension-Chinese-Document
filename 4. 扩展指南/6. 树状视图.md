# 树状视图API

树状视图API允许扩展在Visual Studio Code边栏显示内容。这个内容是一个树结构并且符合VS Code[内建视图](https://code.visualstudio.com/docs/getstarted/userinterface#_views)的样式

例如，内建引用搜索视图扩展使用单独的视图显示引用搜索结果

![](https://code.visualstudio.com/assets/api/extension-guides/tree-view/references-search-tree-view.png)

**Find All References（查找全部引用）**结果在**References（引用）**视图容器中的**References: Results（引用：结果）**树视图中显示

这篇指南教会您如何编写一个贡献树状视图和视图容器给VS Code的扩展

## 树状视图API基础

为了解释树状视图API，我们要构建一个叫做**Node Dependencies（Node依赖）**示例扩展。这个扩展将使用一个树状视图显示当前文件夹所有Node.js依赖。添加一个树状视图的步骤是在`package.json`中贡献树状视图，创建一个`TreeDataProvider`并注册`TreeDataProvider`。您可以在[vscode-extension-samples](https://github.com/microsoft/vscode-extension-samples/tree/main/tree-view-sample/README.md)GitHub仓库的`tree-view-sample`找到这个示例代码的完整源码

### 贡献package.json

首先您要在`package.json`使用[contributes.views](/9.%20参考/2.%20贡献点.md#contributes.views)贡献点让VS Code知道您在贡献一个视图

这里是扩展的第一版`package.json`

```json
{
  "name": "custom-view-samples",
  "displayName": "Custom view Samples",
  "description": "Samples for VS Code's view API",
  "version": "0.0.1",
  "publisher": "alexr00",
  "engines": {
    "vscode": "^1.74.0"
  },
  "activationEvents": [],
  "main": "./out/extension.js",
  "contributes": {
    "views": {
      "explorer": [
        {
          "id": "nodeDependencies",
          "name": "Node Dependencies"
        }
      ]
    }
  },
  "scripts": {
    "vscode:prepublish": "npm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./"
  },
  "devDependencies": {
    "@types/node": "^10.12.21",
    "@types/vscode": "^1.42.0",
    "typescript": "^3.5.1",
    "tslint": "^5.12.1"
  }
}

```

> **注：**如果您的扩展适用于早于1.74版本的VS Code，您必须清楚地在`activationEvents`列出`onView:nodeDepencies`

您必须为视图指定一个标识符和名称，然后您可以贡献在如下位置：

- `explorer`：边栏浏览器视图
- `debug`：边栏的运行调试视图
- `scm`：边栏的源代码控制视图
- `test`：边栏的测试视图
- [自定义视图容器](#视图容器)

### 树数据供应者

第二步是供应数据给您注册的视图以让VS Code在视图中显示数据。为了这么做，您第一步需要实现[TreeDataProvider](/9.%20参考/1.%20VS%20Code%20API.md#TreeDataProvider)。我们的`TreeDataProvider`将供应Node依赖数据，但是您可以拥有提供其他类型数据的数据供应者

这里有两个在这个API中您必须实现的方法:

- `getChildren(element?: T): ProviderResult<T[]>` - 这个方法的实现给定`element`或根（如果不传递元素）的子节点
- `getTreeItem(element: T): TreeItem | Thenable<TreeItem>` - 这个方法的实现返回UI元素在视图中显示的表达([TreeItem](/9.%20参考/1.%20VS%20Code%20API.md#TreeItem))

